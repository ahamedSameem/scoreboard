<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Badminton Scoreboard</title>

<style>
body {
  margin: 0;
  background: transparent;
  overflow: hidden;
  font-family: Arial, sans-serif;
}
.overlay {
  position: absolute;
  top: 40px;
  left: 40px;
  width: 350px;
  z-index: 2;
  font-size: 13px;
}
.scoreboard {
  background-color: #FFFFFF;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.player-row {
  display: flex;
  align-items: center;
  height: 32px;
  border-bottom: 1px solid #e0e0e0;
}
.player-row:last-child { border-bottom: none; }
.player-info {
  flex: 1;
  padding: 0 6px;
  display: flex;
  align-items: center;
}
.player-name {
  font-weight: bold;
  font-size: 14px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  flex: 1;
}
.score-section {
  flex: 0 0 40px;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 16px;
  color: white;
  margin-left: 4px;
  border-radius: 4px;
  background-color: #2196F3;
}
.score-section.active-set { border: 2px solid yellow; }
.score-section.winning { background-color: #4CAF50; }
.score-section.losing { background-color: #9E9E9E; }
.cock {
  width: 16px;
  height: 16px;
  background-color: #9E9E9E;
  border-radius: 2px;
  margin-left: 6px;
  display: none;
}
</style>
</head>

<body>

<div class="overlay">
  <div class="scoreboard">

    <!-- LEFT TEAM -->
    <div class="player-row">
      <img id="flagLeft" src="" width="36" height="24">
      <div class="player-info">
        <div id="nameLeft" class="player-name">Team A</div>
        <img id="cockLeft" class="cock" src="https://cdn-icons-png.flaticon.com/512/1598/1598740.png">
      </div>

      <div id="set1Left" class="score-section">0</div>
      <div id="set2Left" class="score-section" style="display:none;">0</div>
      <div id="set3Left" class="score-section" style="display:none;">0</div>
    </div>

    <!-- RIGHT TEAM -->
    <div class="player-row">
      <img id="flagRight" src="" width="36" height="24">
      <div class="player-info">
        <div id="nameRight" class="player-name">Team B</div>
        <img id="cockRight" class="cock" src="https://cdn-icons-png.flaticon.com/512/1598/1598740.png">
      </div>

      <div id="set1Right" class="score-section">0</div>
      <div id="set2Right" class="score-section" style="display:none;">0</div>
      <div id="set3Right" class="score-section" style="display:none;">0</div>
    </div>

  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// ðŸ”¹ Firebase config
var firebaseConfig = {
  apiKey: "AIzaSyADGPtJxl-HrEhQlwnEUDF0DJyz1xHQcE0",
  authDomain: "scoreboard-2134f.firebaseapp.com",
  databaseURL: "https://scoreboard-2134f-default-rtdb.firebaseio.com",
  projectId: "scoreboard-2134f",
  storageBucket: "scoreboard-2134f.firebasestorage.app",
  messagingSenderId: "921556967860",
  appId: "1:921556967860:web:4cfed77fe01c59ca1b12e1",
  measurementId: "G-DJ3G2XPKMF"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.database().ref("scoreboard");
let currentSet = 1;

// ðŸ”¹ DOM Elements
const nameLeft = document.getElementById("nameLeft");
const nameRight = document.getElementById("nameRight");
const flagLeft = document.getElementById("flagLeft");
const flagRight = document.getElementById("flagRight");
const cockLeft = document.getElementById("cockLeft");
const cockRight = document.getElementById("cockRight");

db.on("value", snapshot => {
  const data = snapshot.val();
  if (!data) return;

  currentSet = data.current_set;

  // Team Names
  nameLeft.innerText = data.team_info.left.name;
  nameRight.innerText = data.team_info.right.name;

  // Flags (force refresh)
  flagLeft.src = data.team_info.left.flag + "?t=" + Date.now();
  flagRight.src = data.team_info.right.flag + "?t=" + Date.now();

  // Service Indicators
  cockLeft.style.display  = data.server === "left"  ? "inline-block" : "none";
  cockRight.style.display = data.server === "right" ? "inline-block" : "none";

  // SET SCORE HANDLING
  for (let i = 1; i <= 3; i++) {
    const leftBox  = document.getElementById(`set${i}Left`);
    const rightBox = document.getElementById(`set${i}Right`);

    // Show only up to current set
    if (i <= currentSet) {
      leftBox.style.display = "flex";
      rightBox.style.display = "flex";
    } else {
      leftBox.style.display = "none";
      rightBox.style.display = "none";
      continue;
    }

    // Get scores
    let leftScore  = data.sets[String(i)].left;
    let rightScore = data.sets[String(i)].right;

    leftBox.innerText  = leftScore;
    rightBox.innerText = rightScore;

    // Active Set Highlight
    if (i === currentSet) {
      leftBox.classList.add("active-set");
      rightBox.classList.add("active-set");
    } else {
      leftBox.classList.remove("active-set");
      rightBox.classList.remove("active-set");
    }

    // Winner Coloring
    leftBox.classList.remove("winning", "losing");
    rightBox.classList.remove("winning", "losing");

    if (leftScore > rightScore) {
      leftBox.classList.add("winning");
      rightBox.classList.add("losing");
    } else if (rightScore > leftScore) {
      leftBox.classList.add("losing");
      rightBox.classList.add("winning");
    }
  }
});
</script>

</body>
</html>
